# transformer-malware-classification

Classification of PE (`.exe`) files using a basic vision transformer with binaries as input

## Training

To begin training, you will need to provide your own samples of malicious and benign files for hopefully obvious reasons. 
These samples should replace those currently in the subfolders `malicious` and `benign` of the `dataset` folder (which you will create).

From there, you need to choose how the input will be represented for the model. 
[`disassemble.py`](./disassemble.py) can be used to extract the `.text` section of input executables if that is the representation you choose. 
[`prepare_data.py`](./prepare_data.py) can be used to simply change the extension of the files to `.bin` to treat the whole binary as an image. 

Regardless of what you choose, it is expected that the input binaries either have a `.exe` extension or the path is long enough to indicate that the name of the file is its hash. 
The hash being used for the name such that the binary cannot be accidentally run as easily on platforms like Windows for malicious input. 

After feature extraction is complete, you will need to separate out which binaries you want to use for training and evaluation with training samples going in `features/train` subfolders `benign` and `malicious`, and evaluation samples going in `features/eval` subfolders `benign` and `malicious`.

After this, you should have a file tree that looks like so:

```
.
├── dataset
│   ├── benign
│   └── malicious
├── features
│   ├── eval
│   │   ├── benign
│   │   └── malicious
│   └── train
│       ├── benign
│       └── malicious
└── model
```

You are now ready to train the model. 

On Windows, the command to train the model is likely:
```shell 
py train.py
```

And everywhere else:
```shell 
python3 train.py
```

Grab a cup of coffee or whatever your favorite beverage is, take a walk, or some other long activity as this will take a while. 
Each epoch, the average loss and accuracy on the evaluation samples will be reported. 
Training can be stopped and resumed, but it currently will restart the epoch counter so keep that in mind. 

## Results

With ~2k samples and extracting the `.text` section of the executable files, the model achieved an accuracy in classification of [82.4121%](https://github.com/samhaswon/transformer-malware-classification/releases/tag/v1.0.0).

With 2k samples of full binaries, the model achieved an accuracy in classification of ??.????%.

## Evaluation

This repository includes an [evaluation script](./eval.py) for evaluation of the `.onnx` model on samples that have gone through the appropriate feature extraction. 
It can be rather slow if you do not have ONNX setup on your system to utilize GPU acceleration. 
